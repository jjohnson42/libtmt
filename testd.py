import fcntl
import sys
import os
import select
import subprocess
import struct

sample2 = b'\x1b(0lqk\x1b(Bbob\r\n\r\n\x1b(0lqk\x1b(Bbob\r\n\x1b[2;2H'
sample = b'\x1b)0\x1b[1;24r\x1b[m\x1b(B\x1b[4l\x1b[?7h\x1b[H\x1b[J\x1b[23B\x1b[J\x1b[H YaST2 - menu @ d5\x1b[K\r\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\x1b[12;24H\x1b[1K Loading modules, please wait ...\x1b[K\r\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\x1b[2;80H\x1b[m\x1b(B\r\x1b[0;1m\x1b(B\x1b[K\n \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[12;57H\x1b[1P\r\n \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08 \x1b[1P\n\x08\x1b[K\x1b[2;80H\x1b[m\x1b(B\r\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\n\x1b[K\x1b[H\n\x1b[m\x1b(B\n\x1b[2C\x1b[0m\x1b(0lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[4;31H\x1b[0m\x1b(0\x1b[0;1m\x1b(BYaST Control Center\x1b[27C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\n\n\x1b[75D\x1b[0m\x1b(0lqqqqqqqqqqqqqqqqqqqqk\x1b[0m\x1b(B \x1b[0m\x1b(0lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[8;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[9;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[10;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[11;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[12;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[13;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[14;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[15;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[16;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[17;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[18;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0m\x1b(0mqqqqqqqqqqqqqqqqqqqqj\x1b[0m\x1b(B \x1b[0m\x1b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\n\n\x1b[75D\x1b[0m\x1b(0\x1b[0m\x1b(B[\x1b[0;1m\x1b(BH\x1b[0m\x1b(Belp]\x1b[21;68H[\x1b[0;1m\x1b(BR\x1b[0m\x1b(Bun][\x1b[0;1m\x1b(BQ\x1b[0m\x1b(Buit]\x1b[19A \x1b[m\x1b(B\r\x1b[0;1m\x1b(B\x1b[K\n \x1b[76C\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[4;1H \x1b[76C\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[5;1H \x1b[76C\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[6;1H \x1b[1P\n\x08 \x1b[0m\x1b(B \x1b[0;1m\x1b(0lqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[8;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[8;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[9;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[9;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[10;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[10;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[11;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[11;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[12;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[12;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[13;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[13;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[14;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[14;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[15;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[15;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[16;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[16;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[17;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[17;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[18;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[18;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[19;1H \x1b[0m\x1b(B \x1b[0;1m\x1b(0mqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\x1b[53C\x1b[0;1m\x1b(0\x1b[0m\x1b(B  \x1b[0;1m\x1b(B \x1b[20;1H \x1b[1P\n\x08 \x1b[77C\x1b[0m\x1b(B \x1b[0;1m\x1b(B \x1b[22;1H \x1b[1P\n\x08\x1b[K\x1b[2;80H\x1b[m\x1b(B\r\x1b[22B\x1b[0;7m\x1b(B F1 \x1b[0m\x1b(BHelp \x1b[0;7m\x1b(B F9 \x1b[0m\x1b(BQuit\x1b[2;80H\x1b[m\x1b(B\x1b[7;3H\x1b[0m\x1b(0lqqqqqqqqqqqqqqqqqqqqk\x1b[0m\x1b(B \x1b[0;1m\x1b(0lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0;1m\x1b(BSoftware          \x1b[0m\x1b(B  \x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BSystem\x1b[9;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BHardware\x1b[10;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BNetwork Services    \x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BSecurity and Users  \x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BSupport\x1b[13;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b[0m\x1b(BMiscellaneous\x1b[7C\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[15;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[16;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[17;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[18;24H\x1b[0m\x1b(0x\x1b[0m\x1b(B \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[75D\x1b[0;1m\x1b(0\x1b[0m\x1b(0mqqqqqqqqqqqqqqqqqqqqj\x1b[0m\x1b(B \x1b[0;1m\x1b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\x1b[2;80H\x1b[0;1m\x1b(0\x1b(B\x1b[m\x1b(B\x1b[7;26H\x1b[0m\x1b(0lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\x1b[8;26H\x1b[0m\x1b(0x\x1b[0;1m\x1b(BSoftware Management  \x1b[29C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[9;26H\x1b[0m\x1b(0x\x1b[0m\x1b(BAdd-On Products\x1b[35C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[10;26H\x1b[0m\x1b(0x\x1b[0m\x1b(BMedia Check\x1b[39C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[11;26H\x1b[0m\x1b(0x\x1b[0m\x1b(BSoftware Repositories\x1b[29C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[12;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[13;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[14;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[15;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[16;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[17;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[18;26H\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[50C\x1b[0m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[19;26H\x1b[0m\x1b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\n\n\x1b[75D\x1b[0m\x1b(0\x1b[0m\x1b(B[\x1b[0;1m\x1b(BH\x1b[0m\x1b(Belp]\x1b[2;80H\x1b[m\x1b(B\x1b[21;3H[\x1b[0;1m\x1b(BH\x1b[0m\x1b(Belp]\x1b[2;80H\x1b[m\x1b(B\x1b[7;3H\x1b[0;1m\x1b(0lqqqqqqqqqqqqqqqqqqqqk\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b[0;1m\x1b(BSoftware          \x1b[0m\x1b(B  \x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[9;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[10;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[11;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[12;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[13;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[14;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[15;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[16;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[17;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\x1b[18;24H\x1b[0;1m\x1b(0x\x1b(B\x1b[m\x1b(B\n\x1b[22D\x1b[0;1m\x1b(0mqqqqqqqqqqqqqqqqqqqqj\x1b(B\x1b[m\x1b(B\x1b[2;80H\x1b[0;1m\x1b(0\x1b(B\x1b[m\x1b(B'

def set_node(p, nodename):
    if not isinstance(nodename, bytes):
        nodename = nodename.encode('utf8')
    p.stdin.write(struct.pack('I', len(nodename) | (1 << 29)))
    p.stdin.write(nodename)
    p.stdin.flush()

def chunk_output(output, n):
    for i in range(0, len(output), n):
        yield output[i:i + n]

def send_output(p, output):
    for chunk in chunk_output(output, 8192):
        p.stdin.write(struct.pack('I', len(chunk) | (2 << 29)))
        p.stdin.write(chunk)
        p.stdin.flush()

def get_output(p, node):
    if not isinstance(node, bytes):
        node = node.encode('utf8')
    p.stdin.write(struct.pack('I', len(node)))
    p.stdin.write(node)
    p.stdin.flush()
    outdata = b''
    select.select((p.stdout,), (), (), 0)
    while not outdata or outdata[-1]:
        chunk = p.stdout.read(128)
        if chunk:
            outdata += chunk
        else:
            select.select((p.stdout,), (), (), 0)
    return outdata[:-1]
    
p = subprocess.Popen(['./termbufferd'], stdin=subprocess.PIPE, stdout=subprocess.PIPE)
fl = fcntl.fcntl(p.stdout.fileno(), fcntl.F_GETFL)
fcntl.fcntl(p.stdout.fileno(), fcntl.F_SETFL, fl | os.O_NONBLOCK)
#import time
#time.sleep(10) # hook to gdb/strace attach
#set_node(p, 'd5')
#send_output(p, sample)
set_node(p, 'd6')
send_output(p, sample2)
#sys.stdout.write(repr(get_output(p, 'd5')))
sys.stdout.buffer.write(get_output(p, 'd6'))
#sys.stdout.buffer.write(get_output(p, 'd5'))
#sys.stdout.buffer.write(sample)
sys.stdout.flush()
import time
time.sleep(3)
p.kill()
